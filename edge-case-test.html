<!DOCTYPE html>
<html>
<head>
    <title>StreamWatch Edge Case Test</title>
    <meta charset="UTF-8">
</head>
<body>
    <h1>Edge Case Test for StreamWatch</h1>
    <p>This page tests various edge cases for StreamWatch initialization.</p>
    
    <div id="dynamic-content">
        <!-- Content will be dynamically added -->
    </div>
    
    <script>
        // Simulate a problematic page that loads content dynamically
        
        // Test 1: Add content after a delay (simulating SPA behavior)
        setTimeout(() => {
            const div = document.createElement('div');
            div.innerHTML = `
                <video src="https://example.com/delayed-video.mp4" controls></video>
                <a href="https://example.com/playlist.m3u8">M3U8 Link</a>
            `;
            document.getElementById('dynamic-content').appendChild(div);
            console.log('Dynamic content added after 2 seconds');
        }, 2000);
        
        // Test 2: Simulate route change (for SPA testing)
        setTimeout(() => {
            // Trigger history change
            history.pushState({}, '', '/new-route');
            console.log('Route changed to /new-route');
            
            // Add more content
            setTimeout(() => {
                const div = document.createElement('div');
                div.innerHTML = '<video src="https://example.com/route-video.mp4" controls></video>';
                document.getElementById('dynamic-content').appendChild(div);
                console.log('Content added after route change');
            }, 1000);
        }, 4000);
        
        // Test 3: Simulate CSP blocking by creating restrictive meta tag
        const meta = document.createElement('meta');
        meta.httpEquiv = 'Content-Security-Policy';
        meta.content = "script-src 'self'; style-src 'self'";
        document.head.appendChild(meta);
        console.log('CSP meta tag added');
    </script>
</body>
</html>